<script setup lang="ts">
import moment from 'moment'
import { onMounted } from 'vue'
import { Tooltip } from 'bootstrap'
import { useMainStore } from '@/stores/main'
import { storeToRefs } from 'pinia'

const props = defineProps({
  pageContent: {}
})

const now = moment()
const { ssot } = storeToRefs(useMainStore())

const { calculatedKnowledgeLevel } = useMainStore()
// const settings =

onMounted(() => {
  console.log('pageContent-end', props.pageContent)
  new Tooltip(document.body, {
    selector: "[data-bs-toggle='tooltip']"
  })
})

let secCounter = 0
let msCounter = 0

function calcDisplayTimer() {
  if (msCounter > 9) {
    msCounter = 0
    secCounter += 1
  } else {
    msCounter += 1
  }

  return 'animate__animated animate__fadeInLeft del-' + secCounter + '-' + msCounter
}
</script>

<template>
  <div
    v-if="pageContent"
    v-for="(container, index) in pageContent.content_containers"
    :key="container.name"
    class="col-sm-12 col-md-6 mb-3"
    :class="calcDisplayTimer()"
  >
    <div class="card bg-gradient-dark text-white-50 border shadow-md">
      <div class="card-body">
        <div class="deco">&nbsp;</div>
        <h5 class="card-title text-white">{{ container.title }}</h5>
        <hr />
        <div v-show="container.container_note">
          <p
            v-if="Array.isArray(container.container_note)"
            v-for="item in container.container_note"
            class="card-text mb-1"
          >
            {{ item }}
          </p>
          <p v-else class="card-text mb-1">{{ container.container_note }}</p>
          <hr />
        </div>

        <div class="row" v-for="skill in container.content">
          <div class="col-8">
            <h6 class="text-white sh">
              {{ skill.name }} <small>{{ skill.versions }}</small>
            </h6>
          </div>
          <div class="col-4">
            <div class="d-flex justify-content-end">
              <div v-if="skill.date_started" class="text-end">
                {{ now.diff(moment(skill.date_started, 'YYYY'), 'years') }} y
              </div>
              <div class="col-4 text-end">
                <a
                  href="#"
                  v-if="skill.knowledge_level"
                  class="link-info text-nowrap text-uppercase"
                  data-bs-toggle="tooltip"
                  :data-bs-title="calculatedKnowledgeLevel(skill.knowledge_level).tooltip"
                >
                  {{ calculatedKnowledgeLevel(skill.knowledge_level).short }}
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped></style>
